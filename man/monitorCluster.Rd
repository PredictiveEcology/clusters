% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tracking.R
\name{monitorCluster}
\alias{monitorCluster}
\title{Watch active threads across PSOCK workers and track per-core peaks}
\usage{
monitorCluster(cl, cores, pad = 2, interval = 1)
}
\arguments{
\item{cl}{A PSOCK cluster object (e.g., created with
\code{parallelly::makeClusterPSOCK()}) connected to the remote machines
corresponding to \code{cores}.}

\item{cores}{A character vector of core (host) names. The order and names
define column layout and are used to name the returned peak vector.}

\item{pad}{Integer number of spaces to insert \emph{between} columns
(default: \code{2}). Padding is not part of the alignment width.}

\item{interval}{Numeric number of seconds to wait between refreshes
(default: \code{1}).}
}
\value{
Invisibly returns a named integer vector of peak active thread counts,
with names matching \code{cores}. Also prints a final aligned summary on
interrupt.
}
\description{
Continuously queries each worker for the number of active threads via
\code{clusters::numActiveThreads()} and displays a single, aligned status line
that updates in place. It also tracks the \strong{peak} thread count per core
(named by the \code{cores} vector). On interrupt (Ctrl-C), it prints a final
aligned summary of peak values and returns them invisibly.
}
\details{
The display renders a one-line header of core names (left-aligned),
followed by a live one-line status of current counts (right-aligned within
the width of each core name). Lines are redrawn in-place using ANSI erase
sequences (\verb{\\033[2K\\r}) which are supported in RStudio Server and most
ANSI-aware terminals.
\itemize{
\item The function calls \code{clusters::numActiveThreads()} on each worker.
If a worker errors, that tick treats the value as \code{NA} for display
and as \code{0} when updating the peak (so peaks are not reduced by \code{NA}s).
\item The header is printed once. Each subsequent update clears and redraws only
the live values line using ANSI sequences. If ANSI is not supported by the
current console, the escape codes may appear literally; in that case, run
the function in RStudio Server, a modern terminal, or adapt it to use
fallbacks.
\item The function runs until interrupted (e.g., \kbd{Ctrl-C}). On interrupt, it
clears the live line, prints the final peaks aligned under the header, and
returns the named peak vector invisibly.
}
}
\note{
This function uses ANSI escape sequences to clear and redraw a single line
(\code{"\\033[2K\\r"}). RStudio Server consoles interpret ANSI by default.
If your output is redirected (non-TTY) or ANSI is disabled, consider
adapting the clearing step to use a fallback (e.g., overwrite with spaces).
}
\section{Requirements on workers}{

The \pkg{clusters} package must be installed on each worker. This function
issues \code{parallel::clusterEvalQ(cl, requireNamespace("clusters"))} once
to assert availability, but it does not install packages remotely.
}

\examples{
\dontrun{
if (FALSE) {
library(parallelly)
library(parallel)

cores <- c("birds", "biomass", "camas", "carbon", "caribou", "coco",
           "core", "dougfir", "fire", "mpb", "sbw", "mega",
           "acer", "abies", "pinus")

# Create a PSOCK cluster over SSH (example; configure to your environment)
cl <- parallelly::makeClusterPSOCK(
 workers = cores,
  rshcmd = "ssh",
   homogeneous = FALSE
 )

# Watch and track peaks; press Ctrl-C to stop.
peak <- monitorCluster(cl, cores, pad = 2, interval = 1)

# After interrupt, 'peak' is a named integer vector with per-core maxima.
print(peak)

stopCluster(cl)
}
}

}
\seealso{
\code{\link[parallelly]{makeClusterPSOCK}},
\code{\link[parallel]{clusterEvalQ}},
\code{\link[clusters]{numActiveThreads}}
}
